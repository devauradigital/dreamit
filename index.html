<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goal Tracker App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #1a1a1a;
            color: #e5e7eb;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .card {
            transition: all 0.3s ease;
            background-color: #2d2d2d;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
        }

        .goal-card {
            cursor: move;
        }

        .goal-card.dragging {
            opacity: 0.5;
            transform: scale(0.98);
        }

        .progress-bar {
            transition: width 1s ease-in-out;
            background-color: #3b82f6 !important;
        }

        .milestone-checkbox:checked + label {
            text-decoration: line-through;
            color: #9ca3af;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes wave {
            0% { transform: rotate(0deg); }
            15% { transform: rotate(14deg); }
            30% { transform: rotate(-8deg); }
            45% { transform: rotate(12deg); }
            60% { transform: rotate(-4deg); }
            75% { transform: rotate(10deg); }
            100% { transform: rotate(0deg); }
        }

        .wave-hand {
            display: inline-block;
            animation: wave 2.5s infinite ease-in-out;
            transform-origin: 70% 70%;
        }

        .btn {
            transition: all 0.3s ease;
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
        }

        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2563eb;
            transform: translateY(-2px);
        }

        .btn-secondary {
            color: #9ca3af;
        }

        .btn-secondary:hover {
            background-color: #4b5563;
        }

        .btn-danger:hover {
            background-color: rgba(239, 68, 68, 0.1);
        }

        .input-field, .select-field, .textarea-field {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #4b5563;
            border-radius: 0.375rem;
            background-color: #2d2d2d;
            color: #e5e7eb;
            transition: all 0.3s ease;
        }

        .input-field:focus, .select-field:focus, .textarea-field:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px #3b82f6;
        }

        .text-gray-400 {
            color: #9ca3af !important;
        }

        .text-gray-200 {
            color: #e5e7eb !important;
        }

        .text-gray-300 {
            color: #9ca3af !important;
        }

        .error-message {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="mb-10">
            <div class="flex justify-between items-center">
                <div>
                    <img src="navbarlogo.png" alt="Goal Tracker Logo" class="h-10 w-auto">
                    <p class="text-xl text-gray-200 mt-2">Hi, Akshat <span class="wave-hand">ðŸ‘‹</span></p>
                </div>
            </div>
            <p class="text-gray-300 mt-2">Your companion for reaching your goals</p>
        </header>

        <nav class="mb-8 border-b" style="border-color: #4b5563;">
            <ul class="flex space-x-8">
                <li><button class="tab-btn active py-2 px-1 border-b-2 border-blue-400 text-blue-400" data-tab="dashboard" aria-selected="true">Dashboard</button></li>
                <li><button class="tab-btn py-2 px-1 hover:text-blue-400" data-tab="analytics" aria-selected="false">Analytics</button></li>
                <li><button class="tab-btn py-2 px-1 hover:text-blue-400" data-tab="export-import" aria-selected="false">Export/Import</button></li>
            </ul>
        </nav>

        <div id="dashboard" class="tab-content active">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="goalsContainer">
                <!-- Goal Cards and Add More Goals button will be dynamically inserted here -->
            </div>
            <div id="noGoalsMessage" class="text-center py-20">
                <img src="no_goal.png" alt="No goals yet illustration - peaceful landscape with mountains and a checkmark in the sky" class="mx-auto mb-4 rounded-lg" style="width: 300px; height: 200px;">
                <h3 class="text-xl font-semibold text-gray-200">No goals yet</h3>
                <p class="text-gray-400 mb-4">Create your first goal to begin your journey.</p>
                <button id="createFirstGoalBtn" class="btn btn-primary">Create Your First Goal</button>
            </div>
        </div>

        <div id="analytics" class="tab-content">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <div class="card p-6 rounded-xl">
                    <h3 class="text-lg font-semibold mb-4" style="color: #e5e7eb;">Goal Completion Rates</h3>
                    <canvas id="completionChart" height="250"></canvas>
                </div>
                <div class="card p-6 rounded-xl">
                    <h3 class="text-lg font-semibold mb-4" style="color: #e5e7eb;">Goal Categories Distribution</h3>
                    <canvas id="categoryChart" height="250"></canvas>
                </div>
            </div>
        </div>

        <div id="export-import" class="tab-content">
            <div class="card p-6 rounded-xl">
                <h3 class="text-lg font-semibold mb-4" style="color: #e5e7eb;">Export/Import Goals</h3>
                <div class="flex flex-col space-y-4">
                    <button id="exportGoalsBtn" class="btn btn-primary">Export Goals as JSON</button>
                    <div>
                        <label for="importGoalsInput" class="block text-sm font-medium mb-1" style="color: #9ca3af;">Import Goals</label>
                        <input type="file" id="importGoalsInput" accept=".json" class="input-field">
                    </div>
                </div>
            </div>
        </div>

        <div id="goalModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden" role="dialog" aria-labelledby="modalTitle">
            <div class="card rounded-xl p-6 w-full max-w-md mx-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="modalTitle" class="text-xl font-semibold" style="color: #e5e7eb;">Create New Goal</h3>
                    <button id="closeModalBtn" class="text-gray-400 hover:text-gray-200" aria-label="Close modal">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                
                <form id="goalForm">
                    <input type="hidden" id="editGoalId">
                    <div class="mb-4">
                        <label for="goalTitle" class="block text-sm font-medium mb-1" style="color: #9ca3af;">Goal Title</label>
                        <input type="text" id="goalTitle" required class="input-field" placeholder="Enter goal title" aria-describedby="goalTitleError">
                        <p id="goalTitleError" class="error-message">Goal title is required</p>
                    </div>
                    
                    <div class="mb-4">
                        <label for="goalDescription" class="block text-sm font-medium mb-1" style="color: #9ca3af;">Description</label>
                        <textarea id="goalDescription" class="textarea-field" rows="4" placeholder="Enter goal description"></textarea>
                    </div>
                    
                    <div class="mb-4">
                        <label for="goalCategory" class="block text-sm font-medium mb-1" style="color: #9ca3af;">Category</label>
                        <select id="goalCategory" class="select-field" required aria-describedby="goalCategoryError">
                            <option value="">Select Category</option>
                            <option value="health">Health</option>
                            <option value="career">Career</option>
                            <option value="finance">Finance</option>
                            <option value="personal">Personal Growth</option>
                        </select>
                        <p id="goalCategoryError" class="error-message">Please select a category</p>
                    </div>
                    
                    <div id="financeAmountField" class="mb-4 hidden">
                        <label for="targetAmount" class="block text-sm font-medium mb-1" style="color: #9ca3af;">Target Amount (â‚¹)</label>
                        <input type="number" id="targetAmount" min="1" step="1" class="input-field" placeholder="Enter target amount" aria-describedby="targetAmountError">
                        <p id="targetAmountError" class="error-message">Please enter a valid target amount</p>
                    </div>

                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancelGoalBtn" class="btn btn-secondary">Cancel</button>
                        <button type="submit" id="submitGoalBtn" class="btn btn-primary">Create Goal</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="goalDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden" role="dialog" aria-labelledby="detailGoalTitle">
            <div class="card rounded-xl p-6 w-full max-w-md mx-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="detailGoalTitle" class="text-xl font-semibold" style="color: #e5e7eb;"></h3>
                    <div class="flex space-x-2">
                        <button id="editGoalBtn" class="text-gray-400 hover:text-gray-200" title="Edit Goal" aria-label="Edit Goal">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                            </svg>
                        </button>
                        <button id="closeDetailModalBtn" class="text-gray-400 hover:text-gray-200" aria-label="Close modal">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="mb-4">
                    <p id="detailDescription" class="text-sm" style="color: #9ca3af;"></p>
                </div>
                
                <div class="mb-4">
                    <div class="flex justify-between mb-1">
                        <span class="text-sm font-medium text-blue-400">Progress</span>
                        <span id="progressPercentage" class="text-sm font-medium" style="color: #e5e7eb;">0%</span>
                    </div>
                    <div class="w-full bg-gray-600 rounded-full h-2.5" style="background-color: #4b5563;">
                        <div id="detailProgressBar" class="bg-blue-500 h-2.5 rounded-full progress-bar" style="width: 0%"></div>
                    </div>
                    <div id="financeProgressText" class="text-sm mt-2 hidden" style="color: #9ca3af;">
                        Current: â‚¹<span id="currentAmountDisplay">0</span> / â‚¹<span id="targetAmountDisplay">0</span>
                    </div>
                </div>
                
                <div class="flex items-center text-sm mb-3" style="color: #9ca3af;">
                    <span id="detailCategory" class="px-2 py-1 text-xs rounded-full"></span>
                </div>
                
                <div id="milestoneSection" class="hidden">
                    <h4 class="font-medium mb-3" style="color: #e5e7eb;">Milestones</h4>
                    <div id="milestonesList" class="space-y-2 mb-4">
                        <!-- Milestones will be added here -->
                    </div>
                    
                    <div class="flex">
                        <input type="text" id="newMilestoneInput" placeholder="Add a new milestone" class="input-field flex-grow rounded-l-md" aria-label="New milestone">
                        <button id="addMilestoneBtn" class="btn btn-primary rounded-l-none">Add</button>
                    </div>
                </div>
                
                <div id="financeSliderSection" class="hidden">
                    <h4 class="font-medium mb-3" style="color: #e5e7eb;">Current Amount (â‚¹)</h4>
                    <input type="range" idà§à¦°

System: range" id="currentAmountSlider" min="0" max="10000" value="0" class="input-field mb-2" aria-label="Current amount">
                    <div class="flex justify-between text-sm mb-2" style="color: #9ca3af;">
                        <span id="currentAmountLabel">â‚¹0</span>
                        <span id="targetAmountLabel">â‚¹10000</span>
                    </div>
                    <div class="flex items-center">
                        <input type="number" id="currentAmountInput" min="0" step="1" class="input-field" placeholder="Enter current amount" aria-label="Current amount input">
                    </div>
                </div>
                
                <div class="mt-6 flex justify-end space-x-3">
                    <button id="deleteGoalBtn" class="btn btn-danger text-red-400">Delete Goal</button>
                </div>
            </div>
        </div>

        <footer class="mt-10 py-4 text-center text-gray-400">
            <p>Powered By <a href="https://devauradigital.com" target="_blank" class="text-blue-400 hover:text-blue-500 transition">Devaura Digital</a></p>
        </footer>
    
    </div>

    <script>
        // Cached DOM elements
        const elements = {
            dashboardTab: document.getElementById('dashboard'),
            analyticsTab: document.getElementById('analytics'),
            exportImportTab: document.getElementById('export-import'),
            tabBtns: document.querySelectorAll('.tab-btn'),
            goalsContainer: document.getElementById('goalsContainer'),
            noGoalsMessage: document.getElementById('noGoalsMessage'),
            goalModal: document.getElementById('goalModal'),
            goalDetailModal: document.getElementById('goalDetailModal'),
            goalForm: document.getElementById('goalForm'),
            createFirstGoalBtn: document.getElementById('createFirstGoalBtn'),
            closeModalBtn: document.getElementById('closeModalBtn'),
            cancelGoalBtn: document.getElementById('cancelGoalBtn'),
            closeDetailModalBtn: document.getElementById('closeDetailModalBtn'),
            editGoalBtn: document.getElementById('editGoalBtn'),
            deleteGoalBtn: document.getElementById('deleteGoalBtn'),
            addMilestoneBtn: document.getElementById('addMilestoneBtn'),
            newMilestoneInput: document.getElementById('newMilestoneInput'),
            goalCategorySelect: document.getElementById('goalCategory'),
            financeAmountField: document.getElementById('financeAmountField'),
            targetAmountInput: document.getElementById('targetAmount'),
            milestoneSection: document.getElementById('milestoneSection'),
            financeSliderSection: document.getElementById('financeSliderSection'),
            currentAmountSlider: document.getElementById('currentAmountSlider'),
            currentAmountInput: document.getElementById('currentAmountInput'),
            currentAmountLabel: document.getElementById('currentAmountLabel'),
            targetAmountLabel: document.getElementById('targetAmountLabel'),
            currentAmountDisplay: document.getElementById('currentAmountDisplay'),
            targetAmountDisplay: document.getElementById('targetAmountDisplay'),
            modalTitle: document.getElementById('modalTitle'),
            submitGoalBtn: document.getElementById('submitGoalBtn'),
            editGoalId: document.getElementById('editGoalId'),
            goalTitle: document.getElementById('goalTitle'),
            goalDescription: document.getElementById('goalDescription'),
            detailDescription: document.getElementById('detailDescription'),
            progressPercentage: document.getElementById('progressPercentage'),
            detailProgressBar: document.getElementById('detailProgressBar'),
            detailGoalTitle: document.getElementById('detailGoalTitle'),
            detailCategory: document.getElementById('detailCategory'),
            milestonesList: document.getElementById('milestonesList'),
            completionChart: document.getElementById('completionChart'),
            categoryChart: document.getElementById('categoryChart'),
            financeProgressText: document.getElementById('financeProgressText'),
            exportGoalsBtn: document.getElementById('exportGoalsBtn'),
            importGoalsInput: document.getElementById('importGoalsInput'),
            goalTitleError: document.getElementById('goalTitleError'),
            goalCategoryError: document.getElementById('goalCategoryError'),
            targetAmountError: document.getElementById('targetAmountError')
        };

        let goals = [];
        let currentGoalId = null;
        let completionChart, categoryChart;

        // Utility Functions
        const formatCurrency = (amount) => isNaN(amount) ? '0' : amount.toLocaleString('en-IN');
        const getCategoryName = (category) => ({
            'health': 'Health',
            'career': 'Career',
            'finance': 'Finance',
            'personal': 'Personal Growth'
        }[category] || 'Other');

        const getCategoryColor = (category) => ({
            'health': 'bg-green-900 text-green-300',
            'career': 'bg-purple-900 text-purple-300',
            'finance': 'bg-blue-900 text-blue-300',
            'personal': 'bg-pink-900 text-pink-300'
        }[category] || 'bg-gray-900 text-gray-300');

        // Local Storage Functions
        function saveGoals() {
            localStorage.setItem('goals', JSON.stringify(goals));
        }

        function loadGoals() {
            const saved = localStorage.getItem('goals');
            if (saved) {
                goals = JSON.parse(saved);
                goals.forEach(goal => {
                    if (!goal.milestones) goal.milestones = [];
                    updateGoalProgress(goal);
                });
                renderGoals();
                updateCharts();
            }
        }

        // UI Update Functions
        function updateCategoryFields(category) {
            elements.financeAmountField.classList.toggle('hidden', category !== 'finance');
            elements.targetAmountInput.toggleAttribute('required', category === 'finance');
        }

        function updateGoalCard(goal) {
            const goalCard = elements.goalsContainer.querySelector(`.goal-card[data-id="${goal.id}"]`);
            if (!goalCard) return;

            const progressBar = goalCard.querySelector('.progress-bar');
            const progressText = goalCard.querySelector('.text-xs.font-medium');
            const descriptionText = goalCard.querySelector('.text-sm.mb-3');

            progressBar.style.width = `${goal.progress}%`;
            progressText.textContent = `${goal.progress}%`;
            descriptionText.textContent = goal.description || '';
            if (goal.category === 'finance') {
                const financeText = goalCard.querySelector('.text-xs.mt-2');
                financeText.textContent = `Current: â‚¹${formatCurrency(goal.currentAmount)} / â‚¹${formatCurrency(goal.targetAmount)}`;
            }
        }

        function updateGoalDetailModal(goal) {
            const {
                detailGoalTitle, detailDescription, detailCategory, progressPercentage,
                detailProgressBar, milestoneSection, financeSliderSection, financeProgressText,
                currentAmountSlider, currentAmountInput, currentAmountLabel, targetAmountLabel,
                currentAmountDisplay, targetAmountDisplay, milestonesList
            } = elements;

            detailGoalTitle.textContent = goal.title || 'Untitled';
            detailDescription.textContent = goal.description || '';
            detailCategory.textContent = getCategoryName(goal.category);
            detailCategory.className = `px-2 py-1 text-xs rounded-full ${getCategoryColor(goal.category)}`;
            progressPercentage.textContent = `${goal.progress}%`;
            detailProgressBar.style.width = `${goal.progress}%`;

            milestoneSection.classList.toggle('hidden', goal.category === 'finance');
            financeSliderSection.classList.toggle('hidden', goal.category !== 'finance');
            financeProgressText.classList.toggle('hidden', goal.category !== 'finance');

            if (goal.category === 'finance') {
                const target = goal.targetAmount || 10000;
                currentAmountSlider.max = target;
                currentAmountSlider.value = goal.currentAmount || 0;
                currentAmountInput.max = target;
                currentAmountInput.value = goal.currentAmount || 0;
                currentAmountLabel.textContent = `â‚¹${formatCurrency(goal.currentAmount || 0)}`;
                targetAmountLabel.textContent = `â‚¹${formatCurrency(target)}`;
                currentAmountDisplay.textContent = formatCurrency(goal.currentAmount || 0);
                targetAmountDisplay.textContent = formatCurrency(target);
            } else {
                milestonesList.innerHTML = '';
                (goal.milestones || []).forEach(milestone => {
                    const milestoneItem = document.createElement('div');
                    milestoneItem.className = 'flex items-center';
                    milestoneItem.innerHTML = `
                        <input type="checkbox" id="milestone-${milestone.id}" class="milestone-checkbox mr-2" ${milestone.completed ? 'checked' : ''} aria-label="${milestone.text}">
                        <label for="milestone-${milestone.id}" class="flex-grow" style="color: ${milestone.completed ? '#9ca3af' : '#e5e7eb'}; ${milestone.completed ? 'text-decoration: line-through;' : ''}">${milestone.text}</label>
                    `;
                    milestoneItem.querySelector('input').addEventListener('change', function() {
                        milestone.completed = this.checked;
                        updateGoalProgress(goal);
                        renderGoals();
                        updateCharts();
                        saveGoals();
                    });
                    milestonesList.appendChild(milestoneItem);
                });
            }
        }

        // Goal Management Functions
        function updateGoalProgress(goal) {
            if (!goal) return;
            if (goal.category === 'finance') {
                goal.progress = goal.targetAmount && goal.targetAmount !== 0
                    ? Math.min(100, Math.round((goal.currentAmount / goal.targetAmount) * 100))
                    : 0;
            } else {
                goal.progress = goal.milestones && goal.milestones.length
                    ? Math.round((goal.milestones.filter(m => m.completed).length / goal.milestones.length) * 100)
                    : 0;
            }

            if (currentGoalId === goal.id) updateGoalDetailModal(goal);
            updateGoalCard(goal);
        }

        function renderGoalCard(goal) {
            const goalCard = document.createElement('div');
            goalCard.className = 'goal-card card rounded-xl p-5 cursor-pointer';
            goalCard.dataset.id = goal.id;
            goalCard.draggable = true;
            goalCard.setAttribute('role', 'button');
            goalCard.setAttribute('aria-label', `View details for ${goal.title}`);

            goalCard.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-semibold text-lg" style="color: #e5e7eb;">${goal.title}</h3>
                    <span class="text-xs px-2 py-1 rounded-full ${getCategoryColor(goal.category)}">
                        ${getCategoryName(goal.category)}
                    </span>
                </div>
                <p class="text-sm mb-3" style="color: #9ca3af;">${goal.description || ''}</p>
                <div class="mb-3">
                    <div class="flex justify-between mb-1">
                        <span class="text-xs font-medium text-blue-400">Progress</span>
                        <span class="text-xs font-medium" style="color: #e5e7eb;">${goal.progress}%</span>
                    </div>
                    <div class="w-full rounded-full h-2" style="background-color: #4b5563;">
                        <div class="h-2 rounded-full progress-bar bg-blue-500" style="width: ${goal.progress}%"></div>
                    </div>
                    ${goal.category === 'finance' ? `<div class="text-xs mt-2" style="color: #9ca3af;">Current: â‚¹${formatCurrency(goal.currentAmount)} / â‚¹${formatCurrency(goal.targetAmount)}</div>` : ''}
                </div>
            `;

            goalCard.addEventListener('click', (e) => {
                if (!e.target.closest('.goal-card').classList.contains('dragging')) {
                    openGoalDetail(goal.id);
                }
            });

            goalCard.addEventListener('dragstart', (e) => {
                goalCard.classList.add('dragging');
                e.dataTransfer.setData('text/plain', goal.id);
            });

            goalCard.addEventListener('dragend', () => {
                goalCard.classList.remove('dragging');
                saveGoals();
            });

            goalCard.addEventListener('dragover', (e) => e.preventDefault());

            goalCard.addEventListener('drop', (e) => {
                e.preventDefault();
                const draggedId = e.dataTransfer.getData('text/plain');
                const droppedId = goal.id;
                const draggedGoal = goals.find(g => g.id == draggedId);
                const droppedGoal = goals.find(g => g.id == droppedId);
                const draggedIndex = goals.indexOf(draggedGoal);
                const droppedIndex = goals.indexOf(droppedGoal);

                goals.splice(draggedIndex, 1);
                goals.splice(droppedIndex, 0, draggedGoal);
                renderGoals();
                saveGoals();
            });

            goalCard.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    openGoalDetail(goal.id);
                }
            });

            return goalCard;
        }

        function renderGoals() {
            elements.goalsContainer.innerHTML = '';
            goals.forEach(goal => elements.goalsContainer.appendChild(renderGoalCard(goal)));

            if (goals.length > 0) {
                const addMoreCard = document.createElement('div');
                addMoreCard.className = 'card rounded-xl p-5 flex items-center justify-center';
                addMoreCard.innerHTML = `<button id="addMoreGoalsBtn" class="btn btn-primary w-full h-full text-lg font-semibold">+ Add More Goals</button>`;
                elements.goalsContainer.appendChild(addMoreCard);
                document.getElementById('addMoreGoalsBtn').addEventListener('click', openGoalModal);
            }
            updateNoGoalsMessage();
        }

        function openGoalDetail(id) {
            const goal = goals.find(g => g.id == id);
            if (!goal) return;

            currentGoalId = id;
            updateGoalDetailModal(goal);
            elements.goalDetailModal.classList.remove('hidden');
            elements.detailGoalTitle.focus();
        }

        function openEditGoalModal(id) {
            const goal = goals.find(g => g.id == id);
            if (!goal) return;

            closeGoalDetailModal();
            elements.modalTitle.textContent = 'Edit Goal';
            elements.submitGoalBtn.textContent = 'Update Goal';
            elements.editGoalId.value = goal.id;
            elements.goalTitle.value = goal.title;
            elements.goalDescription.value = goal.description || '';
            elements.goalCategorySelect.value = goal.category;

            updateCategoryFields(goal.category);
            if (goal.category === 'finance') {
                elements.targetAmountInput.value = goal.targetAmount || '';
            }

            elements.goalModal.classList.remove('hidden');
            elements.goalTitle.focus();
        }

        function openGoalModal() {
            resetModal();
            elements.modalTitle.textContent = 'Create New Goal';
            elements.submitGoalBtn.textContent = 'Create Goal';
            elements.goalModal.classList.remove('hidden');
            elements.goalTitle.focus();
        }

        function closeGoalModal() {
            resetModal();
            elements.goalModal.classList.add('hidden');
        }

        function resetModal() {
            elements.goalForm.reset();
            elements.modalTitle.textContent = 'Create New Goal';
            elements.submitGoalBtn.textContent = 'Create Goal';
            elements.editGoalId.value = '';
            elements.goalTitleError.style.display = 'none';
            elements.goalCategoryError.style.display = 'none';
            elements.targetAmountError.style.display = 'none';
            updateCategoryFields('');
        }

        function closeGoalDetailModal() {
            elements.goalDetailModal.classList.add('hidden');
            currentGoalId = null;
        }

        function updateNoGoalsMessage() {
            elements.noGoalsMessage.classList.toggle('hidden', goals.length > 0);
        }

        // Chart Functions
        function initializeCharts() {
            if (!elements.completionChart || !elements.categoryChart || !window.Chart) {
                console.error('Cannot initialize charts: Canvas elements or Chart.js not found');
                return;
            }

            completionChart = new Chart(elements.completionChart.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['Completed', 'In Progress', 'Not Started'],
                    datasets: [{
                        label: 'Goals',
                        data: [0, 0, 0],
                        backgroundColor: ['rgba(59, 130, 246, 0.6)', 'rgba(234, 179, 8, 0.6)', 'rgba(239, 68, 68, 0.6)'],
                        borderColor: ['rgba(59, 130, 246, 1)', 'rgba(234, 179, 8, 1)', 'rgba(239, 68, 68, 1)'],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true, ticks: { precision: 0, color: '#e5e7eb' }, grid: { color: '#4b5563' } },
                        x: { ticks: { color: '#e5e7eb' }, grid: { color: '#4b5563' } }
                    },
                    plugins: { legend: { labels: { color: '#e5e7eb' } } }
                }
            });

            categoryChart = new Chart(elements.categoryChart.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['Health', 'Career', 'Finance', 'Personal'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.6)', 'rgba(239, 68, 68, 0.6)',
                            'rgba(16, 185, 129, 0.6)', 'rgba(249, 115, 22, 0.6)'
                        ],
                        borderColor: [
                            'rgba(59, 130, 246, 1)', 'rgba(239, 68, 68, 1)',
                            'rgba(16, 185, 129, 1)', 'rgba(249, 115, 22, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: { plugins: { legend: { labels: { color: '#e5e7eb' } } } }
            });

            updateCharts();
        }

        function updateCharts() {
            if (!completionChart || !categoryChart) return;

            const completed = goals.filter(g => g.progress === 100).length;
            const inProgress = goals.filter(g => g.progress > 0 && g.progress < 100).length;
            const notStarted = goals.filter(g => g.progress === 0).length;
            completionChart.data.datasets[0].data = [completed, inProgress, notStarted];
            completionChart.update();

            const categories = { health: 0, career: 0, finance: 0, personal: 0 };
            goals.forEach(goal => categories[goal.category] && categories[goal.category]++);
            categoryChart.data.datasets[0].data = [
                categories.health, categories.career, categories.finance, categories.personal
            ];
            categoryChart.update();
        }

        // Export/Import Functions
        function exportGoals() {
            const dataStr = JSON.stringify(goals, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'goals.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function importGoals(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedGoals = JSON.parse(e.target.result);
                    if (!Array.isArray(importedGoals)) throw new Error('Invalid file format');
                    goals = importedGoals.map(goal => ({
                        ...goal,
                        id: goals.length > 0 ? Math.max(...goals.map(g => g.id)) + 1 : 1,
                        milestones: goal.milestones || []
                    }));
                    goals.forEach(updateGoalProgress);
                    renderGoals();
                    updateCharts();
                    saveGoals();
                    updateNoGoalsMessage();
                    alert('Goals imported successfully!');
                } catch (error) {
                    alert('Error importing goals: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // Slider and Input Handlers
        function setupSliderInputListeners() {
            elements.currentAmountSlider.addEventListener('input', () => {
                const goal = goals.find(g => g.id == currentGoalId);
                if (!goal) return;

                goal.currentAmount = parseFloat(elements.currentAmountSlider.value);
                elements.currentAmountLabel.textContent = `â‚¹${formatCurrency(goal.currentAmount)}`;
                elements.currentAmountInput.value = goal.currentAmount;
                updateGoalProgress(goal);
                renderGoals();
                updateCharts();
                saveGoals();
            });

            elements.currentAmountInput.addEventListener('input', () => {
                const goal = goals.find(g => g.id == currentGoalId);
                if (!goal) return;

                let value = parseFloat(elements.currentAmountInput.value);
                if (isNaN(value) || value < 0) value = 0;
                if (value > parseFloat(elements.currentAmountInput.max)) value = parseFloat(elements.currentAmountInput.max);

                goal.currentAmount = value;
                elements.currentAmountSlider.value = value;
                elements.currentAmountLabel.textContent = `â‚¹${formatCurrency(goal.currentAmount)}`;
                updateGoalProgress(goal);
                renderGoals();
                updateCharts();
                saveGoals();
            });
        }

        // Event Listeners
        function setupEventListeners() {
            elements.goalCategorySelect.addEventListener('change', () => updateCategoryFields(elements.goalCategorySelect.value));

            elements.tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    elements.tabBtns.forEach(b => {
                        b.classList.remove('active', 'border-b-2', 'border-blue-400', 'text-blue-400');
                        b.classList.add('text-gray-400');
                        b.setAttribute('aria-selected', 'false');
                    });
                    btn.classList.add('active', 'border-b-2', 'border-blue-400', 'text-blue-400');
                    btn.classList.remove('text-gray-400');
                    btn.setAttribute('aria-selected', 'true');
                    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                    document.getElementById(btn.dataset.tab).classList.add('active');
                    if (btn.dataset.tab === 'analytics') updateCharts();
                });
            });

            elements.createFirstGoalBtn.addEventListener('click', openGoalModal);
            elements.closeModalBtn.addEventListener('click', closeGoalModal);
            elements.cancelGoalBtn.addEventListener('click', closeGoalModal);
            elements.closeDetailModalBtn.addEventListener('click', closeGoalDetailModal);
            elements.editGoalBtn.addEventListener('click', () => openEditGoalModal(currentGoalId));

            elements.goalForm.addEventListener('submit', (e) => {
                e.preventDefault();
                let hasError = false;

                // Reset error messages
                elements.goalTitleError.style.display = 'none';
                elements.goalCategoryError.style.display = 'none';
                elements.targetAmountError.style.display = 'none';

                const title = elements.goalTitle.value.trim();
                if (!title) {
                    elements.goalTitleError.style.display = 'block';
                    hasError = true;
                }

                const category = elements.goalCategorySelect.value;
                if (!category) {
                    elements.goalCategoryError.style.display = 'block';
                    hasError = true;
                }

                const targetAmount = category === 'finance' ? parseFloat(elements.targetAmountInput.value) : null;
                if (category === 'finance' && (!targetAmount || targetAmount <= 0)) {
                    elements.targetAmountError.style.display = 'block';
                    hasError = true;
                }

                if (hasError) return;

                const description = elements.goalDescription.value.trim();

                if (elements.editGoalId.value) {
                    const goal = goals.find(g => g.id == elements.editGoalId.value);
                    if (!goal) return;

                    Object.assign(goal, {
                        title, description, category,
                        targetAmount: category === 'finance' ? targetAmount : null,
                        currentAmount: category === 'finance' ? Math.min(goal.currentAmount || 0, targetAmount) : null,
                        milestones: category === 'finance' ? [] : goal.milestones || []
                    });
                    updateGoalProgress(goal);
                } else {
                    goals.push({
                        id: goals.length > 0 ? Math.max(...goals.map(g => g.id)) + 1 : 1,
                        title, description, category, progress: 0,
                        milestones: category === 'finance' ? [] : [],
                        targetAmount: category === 'finance' ? targetAmount : null,
                        currentAmount: category === 'finance' ? 0 : null
                    });
                }

                renderGoals();
                closeGoalModal();
                updateNoGoalsMessage();
                updateCharts();
                saveGoals();
            });

            elements.addMilestoneBtn.addEventListener('click', () => {
                const text = elements.newMilestoneInput.value.trim();
                if (!text) {
                    alert('Please enter a milestone');
                    return;
                }

                const goal = goals.find(g => g.id == currentGoalId);
                if (!goal) return;

                goal.milestones.push({
                    id: goal.milestones.length > 0 ? Math.max(...goal.milestones.map(m => m.id)) + 1 : 1,
                    text, completed: false
                });

                openGoalDetail(currentGoalId);
                elements.newMilestoneInput.value = '';
                updateGoalProgress(goal);
                renderGoals();
                updateCharts();
                saveGoals();
            });

            elements.deleteGoalBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to delete this goal?')) {
                    goals = goals.filter(g => g.id != currentGoalId);
                    closeGoalDetailModal();
                    renderGoals();
                    updateNoGoalsMessage();
                    updateCharts();
                    saveGoals();
                }
            });

            elements.exportGoalsBtn.addEventListener('click', exportGoals);
            elements.importGoalsInput.addEventListener('change', importGoals);

            setupSliderInputListeners();

            elements.goalsContainer.addEventListener('dragover', (e) => {
                e.preventDefault();
                const afterElement = getDragAfterElement(elements.goalsContainer, e.clientY);
                const draggable = document.querySelector('.dragging');
                if (afterElement == null) {
                    elements.goalsContainer.insertBefore(draggable, document.getElementById('addMoreGoalsBtn')?.parentElement || null);
                } else {
                    elements.goalsContainer.insertBefore(draggable, afterElement);
                }
            });

            // Keyboard navigation for modals
            elements.goalModal.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closeGoalModal();
            });

            elements.goalDetailModal.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closeGoalDetailModal();
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.goal-card:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                return offset < 0 && offset > closest.offset ? { offset, element: child } : closest;
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            if (!elements.completionChart || !elements.categoryChart) {
                console.error('Canvas elements for charts not found');
                return;
            }
            loadGoals();
            renderGoals();
            setupEventListeners();
            updateNoGoalsMessage();
            initializeCharts();
        });
    </script>
</body>
</html>